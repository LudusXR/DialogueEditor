var Se=Object.defineProperty,we=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var ue=(e,t,s)=>t in e?Se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Q=(e,t)=>{for(var s in t||(t={}))Ie.call(t,s)&&ue(e,s,t[s]);if(ce)for(var s of ce(t))Ee.call(t,s)&&ue(e,s,t[s]);return e},V=(e,t)=>we(e,ke(t));import{d as M,o as c,c as u,a as o,b as ae,F as Te,r as O,D as ge,w as De,e as pe,f as $,g as ne,h as R,i as B,n as he,u as y,t as K,j as H,k as Ae,l as Z,v as ve,p as le,m as ie,C as z,q as J,s as Pe,x as He,R as Fe,y as fe,L as Le,z as Qe,A as Ve,B as ye,_ as Oe,E as Re,G as Be,H as Me}from"./vendor.2d9f739b.js";const Ue=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const v of d.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&a(v)}).observe(document,{childList:!0,subtree:!0});function s(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerpolicy&&(d.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?d.credentials="include":l.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function a(l){if(l.ep)return;l.ep=!0;const d=s(l);fetch(l.href,d)}};Ue();class me{constructor(t,s){this.text=t,this.solvesQuest=s}}class je{constructor(t,s,a,l,d,v){this.name=t,this.playerType=s,this.texts=a,this.useSocialActions=d,this.triggers=l,this.questId=v}}class ze{constructor(t,s){this.x=t,this.y=s}}class Je{constructor(t,s,a,l,d){this.id=t,this.position=s,this.type=a,this.class=l,this.data=d}}class Ye{constructor(t,s,a,l,d){this.id=t,this.source=s,this.target=a,this.sourceHandle=l,this.targetHandle=d}}class xe{}var ee=(e,t)=>{const s=e.__vccOpts||e;for(const[a,l]of t)s[a]=l;return s};const We={class:"save__controls"},Xe={class:"btn"},Ge=ae(" Load scenario "),Ke={inheritAttrs:!1,methods:{onFileChange(e){let t=e.target.files;t==null||!t.length||this.doSomethingWithTheFile(t[0])},onSave(){let e=prompt("Define your file name.");if(this.$props.scenario!=null){let s=JSON.parse(JSON.stringify(this.$props.scenario));s.quests.forEach((a,l)=>{a.order=l}),s.conversations.forEach(a=>{a.nodes.forEach(l=>{if(l.type=="playerNode"){if(l.data.questId>-1){let d=s.quests.find(v=>v.id==l.data.questId);d!=null?l.data.questId=d.order:l.data.questId=-1}delete l.data.quests}})}),s.quests.forEach(a=>{a.id=a.order,delete a.solved,delete a.order});var t=new Blob([JSON.stringify(s)],{type:"application/json"});Te.exports.saveAs(t,e)}},doSomethingWithTheFile(e){let t=new FileReader;t.onload=s=>{if(s.target!=null){let a=JSON.parse(String(s.target.result));console.log(a),this.$emit("json-file-loaded",a)}},t.readAsText(e)}},props:{scenario:xe}},Ze=M(V(Q({},Ke),{setup(e){return(t,s)=>(c(),u("div",We,[o("label",{class:"btn",onClick:s[0]||(s[0]=(...a)=>t.onSave&&t.onSave(...a))},"Save scenario"),o("label",Xe,[o("input",{id:"hiddenInput",type:"file",onChange:s[1]||(s[1]=(...a)=>t.onFileChange&&t.onFileChange(...a))},null,32),Ge])]))}}));var et=ee(Ze,[["__scopeId","data-v-1460b790"]]);const _e=O(new Map);function Ce(){function e(t,...s){_e.value.set(t,s)}return{emit:e,bus:_e}}const T=e=>(le("data-v-08a1690a"),e=e(),ie(),e),tt={class:"hidemenu"},st={key:0},ot=T(()=>o("div",{class:"description"},"Here you can select the dialogs from this scenario",-1)),nt=T(()=>o("hr",null,null,-1)),at=["onClick"],lt={key:1},it=T(()=>o("div",{class:"description"},"Here you can see and edit the quests for the scenario",-1)),rt=T(()=>o("div",{class:"description small"},"Order them in cronological order (top to bottom) using the left handle to drag the quests.",-1)),dt=T(()=>o("hr",null,null,-1)),ct={class:"list-item"},ut=["disabled","onUpdate:modelValue"],pt={key:2},ht=T(()=>o("div",{class:"description"},"Here you can see and edit the briefing for the scenario",-1)),vt=T(()=>o("hr",null,null,-1)),ft={class:"sidemenu"},_t={key:0},gt=T(()=>o("div",{class:"description"},"You can drag these nodes to the pane.",-1)),yt=T(()=>o("hr",null,null,-1)),mt=T(()=>o("div",{class:"description"},"Player Nodes",-1)),xt=T(()=>o("hr",null,null,-1)),Ct=T(()=>o("div",{class:"description"},"NPC Nodes",-1)),Nt=["onDragstart"],bt={inheritAttrs:!1,mounted(){document.querySelectorAll("textarea").forEach(e=>{e.style.height="",e.style.height=e.scrollHeight+"px"})}},$t=M(V(Q({},bt),{props:{scenario:xe},emits:["dialogSelected"],setup(e,{expose:t,emit:s}){const a=e,{nodes:l,edges:d,addNodes:v,setNodes:A,setEdges:F,instance:m,dimensions:C}=ge(),_=(h,n,k,S)=>{h.dataTransfer&&(h.dataTransfer.setData("application/vueflow",n),h.dataTransfer.setData("application/nodeClass",k),h.dataTransfer.setData("application/npcName",S),h.dataTransfer.effectAllowed="move")};let N=null,q=O(null);O(null);let W=1e3;t({reset:()=>{N=null,q.value=null,A([]),F([])}});const X=(h,n)=>{console.log(q),N=h,q.value=n,s("dialogSelected",n),A(h.nodes),F(h.edges)},te=()=>{var h;if(N!=null){let n=prompt("Please enter the new NPC name","");(h=N.actors)==null||h.push(n)}},x=()=>{if(a.scenario!=null){W=W*2;let h={id:W,navigationPoint:{x:0,y:0,z:0},quest:"",questType:0,solved:!1};a.scenario.quests.push(h)}},se=h=>{if(a.scenario!=null){let n=a.scenario.quests.find(S=>S.id==h),k=a.scenario.quests.indexOf(n);a.scenario.quests.splice(k,1)}},{bus:oe}=Ce(),U=new Map;return De(()=>oe.value.get("questChange"),h=>{var n,k;U.clear(),(n=a.scenario)==null||n.conversations.forEach(S=>{S.nodes.forEach(p=>{let g=!1;p.data.texts.forEach(i=>{i.solvesQuest&&(g=!0,console.log(p))}),g&&U.set(p.data.questId,!0)})}),(k=a.scenario)==null||k.quests.forEach(S=>{U.get(S.id)==!0?S.solved=!0:S.solved=!1})}),(h,n)=>{const k=pe("font-awesome-icon"),S=pe("container");return c(),u(R,null,[o("div",tt,[$(S,null,{default:ne(()=>[e.scenario!=null?(c(),u("aside",st,[ot,nt,(c(!0),u(R,null,B(e.scenario.conversations,(p,g)=>(c(),u("div",{key:g,class:he(["vue-flow__node-default",{active:g===y(q)}]),onClick:i=>X(p,g)}," Dialog "+K(g),11,at))),128))])):H("",!0),e.scenario!=null?(c(),u("aside",lt,[it,rt,dt,$(y(Ae),{class:"list-container",list:e.scenario.quests,"item-key":"id",handle:".handle"},{item:ne(({element:p})=>[o("div",ct,[$(k,{icon:"grip",class:"handle"}),Z(o("textarea",{disabled:p.questType!=0,name:"quest","onUpdate:modelValue":g=>p.quest=g,rows:"",class:he({solved:p.solved==!0}),oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"'},null,10,ut),[[ve,p.quest]]),$(k,{icon:"trash",style:{cursor:"pointer"},onClick:g=>se(p.id)},null,8,["onClick"])])]),_:1},8,["list"]),(c(!0),u(R,null,B(e.scenario.quests,(p,g)=>(c(),u("div",{key:g}))),128)),o("button",{onClick:x},"Add Quest")])):H("",!0),e.scenario!=null?(c(),u("aside",pt,[ht,vt,Z(o("textarea",{name:"briefing",id:"briefing","onUpdate:modelValue":n[0]||(n[0]=p=>e.scenario.briefing=p),rows:"10"},null,512),[[ve,e.scenario.briefing]])])):H("",!0)]),_:1})]),o("div",ft,[y(q)!=null?(c(),u("aside",_t,[gt,yt,mt,o("div",{class:"vue-flow__node-default player1",draggable:!0,onDragstart:n[1]||(n[1]=p=>_(p,"playerNode","player1"))}," Player1 Node ",32),o("div",{class:"vue-flow__node-default player2",draggable:!0,onDragstart:n[2]||(n[2]=p=>_(p,"playerNode","player2"))}," Player2 Node ",32),o("div",{class:"vue-flow__node-default playerAll",draggable:!0,onDragstart:n[3]||(n[3]=p=>_(p,"playerNode","playerAll"))}," All Players Node ",32),xt,Ct,(c(!0),u(R,null,B(e.scenario.conversations[y(q)].actors,(p,g)=>(c(),u("div",{key:g,class:"vue-flow__node-default npc",draggable:!0,onDragstart:i=>_(i,"npcNode","npc",p)},K(p),41,Nt))),128)),o("button",{onClick:te},"Add NPC")])):H("",!0)])],64)}}}));var qt=ee($t,[["__scopeId","data-v-08a1690a"]]);const re=e=>(le("data-v-1550e24b"),e=e(),ie(),e),St={style:{position:"relative"}},wt=ae(" NPC - "),kt=re(()=>o("hr",null,null,-1)),It=re(()=>o("div",null," Responses: ",-1)),Et={id:"texts-npcs"},Tt=["value","onInput"],Dt=["onClick"],At=re(()=>o("br",null,null,-1)),Pt={key:0,class:"footer"},Ht={inheritAttrs:!1,mounted(){document.querySelectorAll("textarea").forEach(e=>{e.style.height="",e.style.height=e.scrollHeight+"px"})}},Ft=M(V(Q({},Ht),{props:{id:null,data:null},setup(e){const t=e,s={background:"#555",position:"absolute",top:"20px"};V(Q({},s),{position:"relative",left:"15px",top:"0px",transform:"0"});const a=()=>{let v=new me("",!1);t.data.texts.push(v)},l=(v,A)=>{t.data.texts[A].text=v.target.value},d=v=>{t.data.texts.splice(v,1)};return(v,A)=>(c(),u("div",St,[$(y(J),{type:"target",id:"gi1",position:y(z).Left,style:s,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),$(y(J),{type:"source",id:"go1",position:y(z).Right,style:s,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),o("div",null,[wt,o("strong",null,K(e.data.name),1)]),kt,It,o("ul",Et,[(c(!0),u(R,null,B(e.data.texts,(F,m)=>(c(),u("li",{key:m,style:{position:"relative"}},[o("textarea",{class:"nodrag",value:e.data.texts[m].text,onInput:C=>l(C,m),oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"'},null,40,Tt),o("span",{onClick:C=>d(m)},"x",8,Dt)]))),128))]),At,o("button",{onClick:a},"Add text"),t.data.fullfilsQuest?(c(),u("div",Pt,"Fullfils Quest")):H("",!0)]))}}));var Lt=ee(Ft,[["__scopeId","data-v-1550e24b"]]);const Y=e=>(le("data-v-63f55a74"),e=e(),ie(),e),Qt={style:{position:"relative"}},Vt={key:0},Ot={key:1},Rt={key:2},Bt=Y(()=>o("hr",null,null,-1)),Mt=Y(()=>o("div",null," Responses: ",-1)),Ut={id:"texts-npcs"},jt=["onUpdate:modelValue"],zt=["value","onInput"],Jt=["onClick"],Yt=Y(()=>o("br",null,null,-1)),Wt=Y(()=>o("hr",null,null,-1)),Xt=ae(" Quest: "),Gt=Y(()=>o("option",{value:"-1"},"None",-1)),Kt=["value"],Zt={inheritAttrs:!1,mounted(){document.querySelectorAll("textarea").forEach(e=>{e.style.height="",e.style.height=e.scrollHeight+"px"})}},es=M(V(Q({},Zt),{props:{id:null,data:null},setup(e){const t=e,{emit:s}=Ce(),a={background:"#555",position:"absolute",top:"20px"},l=V(Q({},a),{position:"relative",left:"15px",top:"0px",transform:"0"}),d=()=>{let m=new me("",!1);t.data.texts.push(m)},v=(m,C)=>{t.data.texts[C].text=m.target.value},A=m=>{t.data.texts.splice(m,1)},F=()=>{let m=!1;t.data.texts.forEach((_,N)=>{_.solvesQuest&&(m=!0)});let C={isSolved:m,questId:t.data.questId};s("questChange",C)};return(m,C)=>(c(),u("div",Qt,[$(y(J),{type:"target",id:"gi1",position:y(z).Left,style:a,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),$(y(J),{type:"source",id:"go1",position:y(z).Right,style:a,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),o("div",null,[t.data.playerType=="player1"?(c(),u("strong",Vt,"Player 1")):H("",!0),t.data.playerType=="player2"?(c(),u("strong",Ot,"Player 2")):H("",!0),t.data.playerType=="playerAll"?(c(),u("strong",Rt,"All Players")):H("",!0)]),Bt,Mt,o("ul",Ut,[(c(!0),u(R,null,B(e.data.texts,(_,N)=>(c(),u("li",{key:N,style:{position:"relative"}},[e.data.questId!=-1?Z((c(),u("input",{key:0,type:"checkbox","onUpdate:modelValue":q=>e.data.texts[N].solvesQuest=q,onChange:C[0]||(C[0]=q=>F())},null,40,jt)),[[Pe,e.data.texts[N].solvesQuest]]):H("",!0),o("textarea",{class:"nodrag",value:e.data.texts[N].text,onInput:q=>v(q,N),oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"'},null,40,zt),$(y(J),{id:"p"+N,type:"source",position:y(z).Right,style:l},null,8,["id","position"]),o("span",{onClick:q=>A(N)},"x",8,Jt)]))),128))]),Yt,o("button",{onClick:d},"Add response"),Wt,o("div",null,[Xt,Z(o("select",{"onUpdate:modelValue":C[1]||(C[1]=_=>e.data.questId=_),style:{"max-width":"170px"},onChange:C[2]||(C[2]=_=>F())},[Gt,(c(!0),u(R,null,B(e.data.quests.filter(_=>_.questType==0),_=>(c(),u("option",{value:_.id,key:_.id},[o("span",null,K(_.quest),1)],8,Kt))),128))],544),[[He,e.data.questId]])])]))}}));var ts=ee(es,[["__scopeId","data-v-63f55a74"]]);const ss=M({setup(e){const t=[],{setTransform:s}=Fe(),{instance:a,onConnect:l,nodes:d,edges:v,addEdges:A,addNodes:F,setNodes:m,setEdges:C,onEdgesChange:_,onNodesChange:N,setTranslateExtent:q,setState:W,store:Ne}=ge();let X=0;const te=()=>`node${X++}`;let x=O(null);N(i=>{v.value.forEach(r=>{delete r.selected}),i.forEach(r=>{var f,I;if(n.value!=null&&x.value!=null){if(r.type==="position"){let w=n.value.conversations[x.value].nodes.findIndex(function(E){return E.id==r.id});w>=0&&(n.value.conversations[x.value].nodes[w].position.x=(f=r.position)==null?void 0:f.x,n.value.conversations[x.value].nodes[w].position.y=(I=r.position)==null?void 0:I.y)}else if(r.type==="remove"){let w=n.value.conversations[x.value].nodes.findIndex(function(E){return E.id==r.id});n.value.conversations[x.value].nodes.splice(w,1)}}})}),_(i=>{d.value.forEach(r=>{delete r.selected}),i.forEach(r=>{if(r.type==="remove"&&n.value!=null&&x.value!=null){let f=n.value.conversations[x.value].edges.findIndex(function(I){return I.id==r.id});n.value.conversations[x.value].edges.splice(f,1)}})}),l(i=>{if(A([i]),n.value!=null&&x.value!=null){let r="edge-"+i.source+i.sourceHandle+"-"+i.target+i.targetHandle;n.value.conversations[x.value].edges.push(new Ye(r,i.source,i.target,i.sourceHandle,i.targetHandle))}});const se=i=>{i.preventDefault(),i.dataTransfer&&(i.dataTransfer.dropEffect="move")},oe=i=>{},U=i=>{var r,f,I,w,E;if(a.value){const L=te(),b=[],D=[],P=-1,j=(r=i.dataTransfer)==null?void 0:r.getData("application/vueflow"),G=(f=i.dataTransfer)==null?void 0:f.getData("application/nodeClass"),de=(I=i.dataTransfer)==null?void 0:I.getData("application/npcName"),be=a.value.project({x:i.clientX,y:i.clientY-40}),$e={id:L,type:j,class:G,data:{onChange:oe,onConnect:l,name:de,texts:b,playerType:G,questId:P,quests:(w=n.value)==null?void 0:w.quests},connectable:!0,position:be,label:`${j} node`};F([$e]);let qe=new Je(L,new ze(i.clientX,i.clientY-40),j,G,new je(de,G,b,D,!1,P));(E=n.value)==null||E.conversations[x.value].nodes.push(qe)}},h={npcNode:fe(Lt),playerNode:fe(ts)},n=O(null),k=O(null),S=i=>{var f,I,w,E,L;n.value=null,n.value=i,(f=n.value)==null||f.conversations.forEach(b=>{b.nodes.forEach(D=>{var P;D.type=="playerNode"&&(D.data.quests=(P=n.value)==null?void 0:P.quests)})}),(I=n.value)==null||I.quests.forEach(b=>{b.solved=!1});const r=new Map;(w=n.value)==null||w.conversations.forEach(b=>{b.nodes.forEach(D=>{let P=!1;D.data.texts.forEach(j=>{j.solvesQuest&&(P=!0)}),P&&r.set(D.data.questId,!0)})}),(E=n.value)==null||E.quests.forEach(b=>{r.get(b.id)==!0?b.solved=!0:b.solved=!1}),x.value=null,(L=k.value)==null||L.reset()},p=i=>{var E,L,b;x.value=i;let r=0;(E=n.value)==null||E.conversations[i].nodes.forEach((D,P)=>{Number(D.id.substring(4))>r,r=Number(D.id.substring(4))}),X=r+1;const f=(L=n.value)==null?void 0:L.conversations[i].nodes[0],I=Number(f==null?void 0:f.position.x),w=Number((b=f==null?void 0:f.position)==null?void 0:b.y);s({x:I+200||0,y:w+200||0,zoom:1})},g=O(t);return(i,r)=>(c(),u("div",{class:"dndflow",onDrop:U},[$(y(Ve),{modelValue:g.value,"onUpdate:modelValue":r[0]||(r[0]=f=>g.value=f),onDragover:se,"node-types":h},{default:ne(()=>[$(y(Le),{variant:y(Qe).Lines,"pattern-color":"#4d4d4d",gap:"25"},null,8,["variant"]),$(et,{scenario:n.value,onJsonFileLoaded:S},null,8,["scenario"]),$(qt,{scenario:n.value,onDialogSelected:p,ref_key:"sideBar",ref:k},null,8,["scenario"])]),_:1},8,["modelValue"])],32))}});const os={style:{height:"100vh"}},ns=M({setup(e){return(t,s)=>(c(),u("div",os,[$(ss)]))}});ye.add(Oe);ye.add(Re);Be(ns).component("font-awesome-icon",Me).mount("#app");
