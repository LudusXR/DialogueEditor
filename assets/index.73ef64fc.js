var Se=Object.defineProperty,Ee=Object.defineProperties;var Te=Object.getOwnPropertyDescriptors;var pe=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable;var ve=(e,t,s)=>t in e?Se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,O=(e,t)=>{for(var s in t||(t={}))De.call(t,s)&&ve(e,s,t[s]);if(pe)for(var s of pe(t))Ae.call(t,s)&&ve(e,s,t[s]);return e},R=(e,t)=>Ee(e,Te(t));import{d as U,o as r,c,a as o,b as le,F as Pe,r as L,D as xe,w as He,e as fe,f as w,g as ae,t as z,h as D,i as B,j as M,n as _e,u as y,k as Fe,l as Z,v as ge,m as Qe,p as ie,q as re,C as J,s as Y,x as Le,y as Ve,R as Oe,z as ye,L as Re,A as Be,B as Me,E as qe,_ as Ue,G as je,H as ze,I as Je}from"./vendor.5afcc7fa.js";const Ye=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const p of d.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&l(p)}).observe(document,{childList:!0,subtree:!0});function s(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerpolicy&&(d.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?d.credentials="include":a.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function l(a){if(a.ep)return;a.ep=!0;const d=s(a);fetch(a.href,d)}};Ye();class Ce{constructor(t,s){this.text=t,this.solvesQuest=s}}class be{constructor(t){this.id=t}}class We{constructor(t,s,l,a,d,p){this.name=t,this.playerType=s,this.texts=l,this.useSocialActions=d,this.triggers=a,this.questId=p}}class Xe{constructor(t,s){this.x=t,this.y=s}}class Ge{constructor(t,s,l,a,d){this.id=t,this.position=s,this.type=l,this.class=a,this.data=d}}class Ke{constructor(t,s,l,a,d){this.id=t,this.source=s,this.target=l,this.sourceHandle=a,this.targetHandle=d}}class Ne{}var ee=(e,t)=>{const s=e.__vccOpts||e;for(const[l,a]of t)s[l]=a;return s};const Ze={class:"save__controls"},et={class:"btn"},tt=le(" Load scenario "),st={inheritAttrs:!1,methods:{onFileChange(e){let t=e.target.files;t==null||!t.length||this.doSomethingWithTheFile(t[0])},onSave(){let e=prompt("Define your file name.");if(this.$props.scenario!=null){let s=JSON.parse(JSON.stringify(this.$props.scenario));s.quests.forEach((l,a)=>{l.order=a}),s.conversations.forEach(l=>{l.nodes.forEach(a=>{if(a.type=="playerNode"){if(a.data.questId.id>-1){let p=s.quests.find(A=>A.id==a.data.questId.id);p!=null?a.data.questId.id=p.order:a.data.questId.id=-1}delete a.data.quests;let d=a.data.questId.id;delete a.data.questId,a.data.questId=d}})}),s.quests.forEach(l=>{l.id=l.order,delete l.solved,delete l.order});var t=new Blob([JSON.stringify(s)],{type:"application/json"});Pe.exports.saveAs(t,e)}},doSomethingWithTheFile(e){let t=new FileReader;t.onload=s=>{if(s.target!=null){let l=JSON.parse(String(s.target.result));l.conversations.forEach(a=>{a.nodes.forEach(d=>{let p=d.data.questId;d.data.questId=new be(p)})}),this.$emit("json-file-loaded",{scenario:l,filename:e.name})}},t.readAsText(e)}},props:{scenario:Ne}},ot=U(R(O({},st),{setup(e){return(t,s)=>(r(),c("div",Ze,[o("label",{class:"btn",onClick:s[0]||(s[0]=(...l)=>t.onSave&&t.onSave(...l))},"Save scenario"),o("label",et,[o("input",{id:"hiddenInput",type:"file",onChange:s[1]||(s[1]=(...l)=>t.onFileChange&&t.onFileChange(...l))},null,32),tt])]))}}));var nt=ee(ot,[["__scopeId","data-v-7e0dde3c"]]);const me=L(new Map);function $e(){function e(t,...s){me.value.set(t,s)}return{emit:e,bus:me}}const $=e=>(ie("data-v-311ec362"),e=e(),re(),e),at={class:"hidemenu"},lt={key:0},it=$(()=>o("div",{class:"description"},"Current file being edited:",-1)),rt=$(()=>o("hr",null,null,-1)),dt={key:1},ct=$(()=>o("div",{class:"description"},"Here you can select the dialogs from this scenario",-1)),ut=$(()=>o("hr",null,null,-1)),ht=["onClick"],pt={key:2},vt=$(()=>o("div",{class:"description"},"Here you can see and edit the quests for the scenario",-1)),ft=$(()=>o("div",{class:"description small"},"Order them in cronological order (top to bottom) using the left handle to drag the quests.",-1)),_t=$(()=>o("hr",null,null,-1)),gt={class:"list-item"},yt=["disabled","onUpdate:modelValue"],mt={key:3},xt=$(()=>o("div",{class:"description"},"Here you can see and edit the briefing for the scenario",-1)),qt=$(()=>o("hr",null,null,-1)),Ct={class:"sidemenu"},bt={key:0},Nt=$(()=>o("div",{class:"description"},"You can drag these nodes to the pane.",-1)),$t=$(()=>o("hr",null,null,-1)),It=$(()=>o("div",{class:"description"},"Player Nodes",-1)),kt=$(()=>o("hr",null,null,-1)),wt=$(()=>o("div",{class:"description"},"NPC Nodes",-1)),St=["onDragstart"],Et={inheritAttrs:!1,mounted(){document.querySelectorAll("textarea").forEach(e=>{e.style.height="",e.style.height=e.scrollHeight+"px"})}},Tt=U(R(O({},Et),{props:{scenario:Ne,filename:String},emits:["dialogSelected"],setup(e,{expose:t,emit:s}){const l=e,{nodes:a,edges:d,addNodes:p,setNodes:A,setEdges:F,instance:m,dimensions:C}=xe(),_=(v,n,I,N)=>{v.dataTransfer&&(v.dataTransfer.setData("application/vueflow",n),v.dataTransfer.setData("application/nodeClass",I),v.dataTransfer.setData("application/npcName",N),v.dataTransfer.effectAllowed="move")};let b=null,S=L(null);L(null);let X=1e3;t({reset:()=>{b=null,S.value=null,A([]),F([])}});const G=(v,n)=>{b=v,S.value=n,s("dialogSelected",n),A(v.nodes),F(v.edges)},te=()=>{var v;if(b!=null){let n=prompt("Please enter the new NPC name","");(v=b.actors)==null||v.push(n)}},x=()=>{if(l.scenario!=null){X=X*2;let v={id:X,navigationPoint:{x:0,y:0,z:0},quest:"",questType:0,solved:!1};l.scenario.quests.push(v)}},se=v=>{if(l.scenario!=null){let n=l.scenario.quests.find(N=>N.id==v),I=l.scenario.quests.indexOf(n);l.scenario.quests.splice(I,1)}},{bus:oe}=$e(),j=new Map;return He(()=>oe.value.get("questChange"),v=>{var n,I;j.clear(),(n=l.scenario)==null||n.conversations.forEach(N=>{N.nodes.forEach(h=>{let q=!1;h.data.texts.forEach(V=>{V.solvesQuest&&(q=!0)}),q&&j.set(h.data.questId.id,!0)})}),(I=l.scenario)==null||I.quests.forEach(N=>{j.get(N.id)==!0?N.solved=!0:N.solved=!1})}),(v,n)=>{const I=fe("font-awesome-icon"),N=fe("container");return r(),c(B,null,[o("div",at,[w(N,null,{default:ae(()=>[e.scenario!=null?(r(),c("aside",lt,[it,rt,o("div",null,z(e.filename),1)])):D("",!0),e.scenario!=null?(r(),c("aside",dt,[ct,ut,(r(!0),c(B,null,M(e.scenario.conversations,(h,q)=>(r(),c("div",{key:q,class:_e(["vue-flow__node-default",{active:q===y(S)}]),onClick:V=>G(h,q)}," Dialog "+z(q),11,ht))),128))])):D("",!0),e.scenario!=null?(r(),c("aside",pt,[vt,ft,_t,w(y(Fe),{class:"list-container",list:e.scenario.quests,"item-key":"id",handle:".handle"},{item:ae(({element:h})=>[o("div",gt,[w(I,{icon:"grip",class:"handle"}),Z(o("textarea",{disabled:h.questType!=0,name:"quest","onUpdate:modelValue":q=>h.quest=q,rows:"",class:_e({solved:h.solved==!0}),oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"'},null,10,yt),[[ge,h.quest]]),h.questType==0?(r(),Qe(I,{key:0,icon:"trash",style:{cursor:"pointer"},onClick:q=>se(h.id)},null,8,["onClick"])):D("",!0)])]),_:1},8,["list"]),(r(!0),c(B,null,M(e.scenario.quests,(h,q)=>(r(),c("div",{key:q}))),128)),o("button",{onClick:x},"Add Quest")])):D("",!0),e.scenario!=null?(r(),c("aside",mt,[xt,qt,Z(o("textarea",{name:"briefing",id:"briefing","onUpdate:modelValue":n[0]||(n[0]=h=>e.scenario.briefing=h),rows:"10"},null,512),[[ge,e.scenario.briefing]])])):D("",!0)]),_:1})]),o("div",Ct,[y(S)!=null?(r(),c("aside",bt,[Nt,$t,It,o("div",{class:"vue-flow__node-default player1",draggable:!0,onDragstart:n[1]||(n[1]=h=>_(h,"playerNode","player1"))}," Player1 Node ",32),o("div",{class:"vue-flow__node-default player2",draggable:!0,onDragstart:n[2]||(n[2]=h=>_(h,"playerNode","player2"))}," Player2 Node ",32),o("div",{class:"vue-flow__node-default playerAll",draggable:!0,onDragstart:n[3]||(n[3]=h=>_(h,"playerNode","playerAll"))}," All Players Node ",32),kt,wt,(r(!0),c(B,null,M(e.scenario.conversations[y(S)].actors,(h,q)=>(r(),c("div",{key:q,class:"vue-flow__node-default npc",draggable:!0,onDragstart:V=>_(V,"npcNode","npc",h)},z(h),41,St))),128)),o("button",{onClick:te},"Add NPC")])):D("",!0)])],64)}}}));var Dt=ee(Tt,[["__scopeId","data-v-311ec362"]]);const de=e=>(ie("data-v-2b0ab854"),e=e(),re(),e),At={style:{position:"relative"}},Pt=le(" NPC - "),Ht=de(()=>o("hr",null,null,-1)),Ft=de(()=>o("div",null," Responses: ",-1)),Qt={id:"texts-npcs"},Lt=["value","onInput"],Vt=["onClick"],Ot=de(()=>o("br",null,null,-1)),Rt={key:0,class:"footer"},Bt={inheritAttrs:!1,mounted(){document.querySelectorAll("textarea").forEach(e=>{e.style.height="",e.style.height=e.scrollHeight+"px"})}},Mt=U(R(O({},Bt),{props:{id:null,data:null},setup(e){const t=e,s={background:"#555",position:"absolute",top:"20px"};R(O({},s),{position:"relative",left:"15px",top:"0px",transform:"0"});const l=()=>{let p=new Ce("",!1);t.data.texts.push(p)},a=(p,A)=>{t.data.texts[A].text=p.target.value},d=p=>{t.data.texts.splice(p,1)};return(p,A)=>(r(),c("div",At,[w(y(Y),{type:"target",id:"gi1",position:y(J).Left,style:s,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),w(y(Y),{type:"source",id:"go1",position:y(J).Right,style:s,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),o("div",null,[Pt,o("strong",null,z(e.data.name),1)]),Ht,Ft,o("ul",Qt,[(r(!0),c(B,null,M(e.data.texts,(F,m)=>(r(),c("li",{key:m,style:{position:"relative"}},[o("textarea",{class:"nodrag",value:e.data.texts[m].text,onInput:C=>a(C,m),oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"'},null,40,Lt),o("span",{onClick:C=>d(m)},"x",8,Vt)]))),128))]),Ot,o("button",{onClick:l},"Add text"),t.data.fullfilsQuest?(r(),c("div",Rt,"Fullfils Quest")):D("",!0)]))}}));var Ut=ee(Mt,[["__scopeId","data-v-2b0ab854"]]);const W=e=>(ie("data-v-79afa208"),e=e(),re(),e),jt={style:{position:"relative"}},zt={key:0},Jt={key:1},Yt={key:2},Wt=W(()=>o("hr",null,null,-1)),Xt=W(()=>o("div",null," Responses: ",-1)),Gt={id:"texts-npcs"},Kt=["onUpdate:modelValue"],Zt=["value","onInput"],es=["onClick"],ts=W(()=>o("br",null,null,-1)),ss=W(()=>o("hr",null,null,-1)),os=le(" Quest: "),ns=W(()=>o("option",{value:"-1"},"None",-1)),as=["value"],ls={inheritAttrs:!1,mounted(){document.querySelectorAll("textarea").forEach(e=>{e.style.height="",e.style.height=e.scrollHeight+"px"})}},is=U(R(O({},ls),{props:{id:null,data:null},setup(e){const t=e,{emit:s}=$e(),l={background:"#555",position:"absolute",top:"20px"},a=R(O({},l),{position:"relative",left:"15px",top:"0px",transform:"0"}),d=()=>{let m=new Ce("",!1);t.data.texts.push(m)},p=(m,C)=>{t.data.texts[C].text=m.target.value},A=m=>{t.data.texts.splice(m,1)},F=()=>{let m=!1;t.data.texts.forEach((_,b)=>{_.solvesQuest&&(m=!0)});let C={isSolved:m,questId:t.data.questId.id};s("questChange",C)};return(m,C)=>(r(),c("div",jt,[w(y(Y),{type:"target",id:"gi1",position:y(J).Left,style:l,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),w(y(Y),{type:"source",id:"go1",position:y(J).Right,style:l,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),o("div",null,[t.data.playerType=="player1"?(r(),c("strong",zt,"Player 1")):D("",!0),t.data.playerType=="player2"?(r(),c("strong",Jt,"Player 2")):D("",!0),t.data.playerType=="playerAll"?(r(),c("strong",Yt,"All Players")):D("",!0)]),Wt,Xt,o("ul",Gt,[(r(!0),c(B,null,M(e.data.texts,(_,b)=>(r(),c("li",{key:b,style:{position:"relative"}},[e.data.questId.id!=-1?Z((r(),c("input",{key:0,type:"checkbox","onUpdate:modelValue":S=>e.data.texts[b].solvesQuest=S,onChange:C[0]||(C[0]=S=>F())},null,40,Kt)),[[Le,e.data.texts[b].solvesQuest]]):D("",!0),o("textarea",{class:"nodrag",value:e.data.texts[b].text,onInput:S=>p(S,b),oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"'},null,40,Zt),w(y(Y),{id:"p"+b,type:"source",position:y(J).Right,style:a},null,8,["id","position"]),o("span",{onClick:S=>A(b)},"x",8,es)]))),128))]),ts,o("button",{onClick:d},"Add response"),ss,o("div",null,[os,e.data.quests!=null?Z((r(),c("select",{key:0,"onUpdate:modelValue":C[1]||(C[1]=_=>e.data.questId.id=_),style:{"max-width":"170px"},onChange:C[2]||(C[2]=_=>F())},[ns,(r(!0),c(B,null,M(e.data.quests.filter(_=>_.questType==0),_=>(r(),c("option",{value:_.id,key:_.id},[o("span",null,z(_.quest),1)],8,as))),128))],544)),[[Ve,e.data.questId.id]]):D("",!0)])]))}}));var rs=ee(is,[["__scopeId","data-v-79afa208"]]);const ds=U({setup(e){const t=[],{setTransform:s}=Oe(),{instance:l,onConnect:a,nodes:d,edges:p,addEdges:A,addNodes:F,setNodes:m,setEdges:C,onEdgesChange:_,onNodesChange:b,setTranslateExtent:S,setState:X,store:Ie}=xe();let G=0;const te=()=>`node${G++}`;let x=L(null);b(i=>{p.value.forEach(u=>{delete u.selected}),i.forEach(u=>{var f,E;if(n.value!=null&&x.value!=null){if(u.type==="position"){let k=n.value.conversations[x.value].nodes.findIndex(function(T){return T.id==u.id});k>=0&&(n.value.conversations[x.value].nodes[k].position.x=(f=u.position)==null?void 0:f.x,n.value.conversations[x.value].nodes[k].position.y=(E=u.position)==null?void 0:E.y)}else if(u.type==="remove"){let k=n.value.conversations[x.value].nodes.findIndex(function(T){return T.id==u.id});n.value.conversations[x.value].nodes.splice(k,1)}}})}),_(i=>{d.value.forEach(u=>{delete u.selected}),i.forEach(u=>{if(u.type==="remove"&&n.value!=null&&x.value!=null){let f=n.value.conversations[x.value].edges.findIndex(function(E){return E.id==u.id});n.value.conversations[x.value].edges.splice(f,1)}})}),a(i=>{if(A([i]),n.value!=null&&x.value!=null){let u="edge-"+i.source+i.sourceHandle+"-"+i.target+i.targetHandle;n.value.conversations[x.value].edges.push(new Ke(u,i.source,i.target,i.sourceHandle,i.targetHandle))}});const se=i=>{i.preventDefault(),i.dataTransfer&&(i.dataTransfer.dropEffect="move")},oe=i=>{},j=i=>{var u,f,E,k,T,Q;if(l.value){const g=(u=i.dataTransfer)==null?void 0:u.getData("application/vueflow");if(g=="")return;const P=te(),H=[],ne=[],ce=new be(-1),K=(f=i.dataTransfer)==null?void 0:f.getData("application/nodeClass"),ue=(E=i.dataTransfer)==null?void 0:E.getData("application/npcName"),ke=l.value.project({x:i.clientX,y:i.clientY-40}),we={id:P,type:g,class:K,data:{onChange:oe,onConnect:a,name:ue,texts:H,playerType:K,questId:ce,quests:(k=n.value)==null?void 0:k.quests},connectable:!0,position:ke,label:`${g} node`};F([we]);let he=new Ge(P,new Xe(i.clientX,i.clientY-40),g,K,new We(ue,K,H,ne,!1,ce));he.data.quests=(T=n.value)==null?void 0:T.quests,(Q=n.value)==null||Q.conversations[x.value].nodes.push(he)}},v={npcNode:ye(Ut),playerNode:ye(rs)},n=L(null),I=L(null),N=L(null),h=i=>{var f,E,k,T,Q;n.value=null,n.value=i.scenario,I.value=null,I.value=i.filename,(f=n.value)==null||f.conversations.forEach(g=>{g.nodes.forEach(P=>{var H;P.type=="playerNode"&&(P.data.quests=(H=n.value)==null?void 0:H.quests)})}),(E=n.value)==null||E.quests.forEach(g=>{g.solved=!1});const u=new Map;(k=n.value)==null||k.conversations.forEach(g=>{g.nodes.forEach(P=>{let H=!1;P.data.texts.forEach(ne=>{ne.solvesQuest&&(H=!0)}),H&&u.set(P.data.questId.id,!0)})}),(T=n.value)==null||T.quests.forEach(g=>{u.get(g.id)==!0?g.solved=!0:g.solved=!1}),x.value=null,(Q=N.value)==null||Q.reset()},q=i=>{var T,Q,g;x.value=i;let u=0;(T=n.value)==null||T.conversations[i].nodes.forEach((P,H)=>{Number(P.id.substring(4))>u,u=Number(P.id.substring(4))}),G=u+1;const f=(Q=n.value)==null?void 0:Q.conversations[i].nodes[0],E=Number(f==null?void 0:f.position.x),k=Number((g=f==null?void 0:f.position)==null?void 0:g.y);s({x:E+200||0,y:k+200||0,zoom:1})},V=L(t);return(i,u)=>(r(),c("div",{class:"dndflow",onDrop:j},[w(y(Me),{modelValue:V.value,"onUpdate:modelValue":u[0]||(u[0]=f=>V.value=f),onDragover:se,"node-types":v},{default:ae(()=>[w(y(Re),{variant:y(Be).Lines,"pattern-color":"#4d4d4d",gap:"25"},null,8,["variant"]),w(nt,{scenario:n.value,onJsonFileLoaded:h},null,8,["scenario"]),w(Dt,{scenario:n.value,filename:I.value,onDialogSelected:q,ref_key:"sideBar",ref:N},null,8,["scenario","filename"])]),_:1},8,["modelValue"])],32))}});const cs={style:{height:"100vh"}},us=U({setup(e){return(t,s)=>(r(),c("div",cs,[w(ds)]))}});qe.add(Ue);qe.add(je);ze(us).component("font-awesome-icon",Je).mount("#app");
