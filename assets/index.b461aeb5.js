var ke=Object.defineProperty,Se=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var ue=(e,t,s)=>t in e?ke(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Q=(e,t)=>{for(var s in t||(t={}))Ie.call(t,s)&&ue(e,s,t[s]);if(ce)for(var s of ce(t))Ee.call(t,s)&&ue(e,s,t[s]);return e},V=(e,t)=>Se(e,we(t));import{d as M,o as d,c as u,a as o,b as ae,F as Te,r as O,D as ge,w as De,e as pe,f as S,g as ne,h as R,i as B,n as he,u as y,t as K,j as A,k as Ae,l as Z,v as ve,m as Pe,p as le,q as ie,C as z,s as J,x as He,y as Fe,R as Le,z as fe,L as Qe,A as Ve,B as Oe,E as ye,_ as Re,G as Be,H as Me,I as Ue}from"./vendor.efc9cdcf.js";const je=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const v of c.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&a(v)}).observe(document,{childList:!0,subtree:!0});function s(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerpolicy&&(c.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?c.credentials="include":l.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(l){if(l.ep)return;l.ep=!0;const c=s(l);fetch(l.href,c)}};je();class me{constructor(t,s){this.text=t,this.solvesQuest=s}}class ze{constructor(t,s,a,l,c,v){this.name=t,this.playerType=s,this.texts=a,this.useSocialActions=c,this.triggers=l,this.questId=v}}class Je{constructor(t,s){this.x=t,this.y=s}}class Ye{constructor(t,s,a,l,c){this.id=t,this.position=s,this.type=a,this.class=l,this.data=c}}class We{constructor(t,s,a,l,c){this.id=t,this.source=s,this.target=a,this.sourceHandle=l,this.targetHandle=c}}class xe{}var ee=(e,t)=>{const s=e.__vccOpts||e;for(const[a,l]of t)s[a]=l;return s};const Xe={class:"save__controls"},Ge={class:"btn"},Ke=ae(" Load scenario "),Ze={inheritAttrs:!1,methods:{onFileChange(e){let t=e.target.files;t==null||!t.length||this.doSomethingWithTheFile(t[0])},onSave(){let e=prompt("Define your file name.");if(this.$props.scenario!=null){let s=JSON.parse(JSON.stringify(this.$props.scenario));s.quests.forEach((a,l)=>{a.order=l}),s.conversations.forEach(a=>{a.nodes.forEach(l=>{if(l.type=="playerNode"){if(l.data.questId>-1){let c=s.quests.find(v=>v.id==l.data.questId);c!=null?l.data.questId=c.order:l.data.questId=-1}delete l.data.quests}})}),s.quests.forEach(a=>{a.id=a.order,delete a.solved,delete a.order});var t=new Blob([JSON.stringify(s)],{type:"application/json"});Te.exports.saveAs(t,e)}},doSomethingWithTheFile(e){let t=new FileReader;t.onload=s=>{if(s.target!=null){let a=JSON.parse(String(s.target.result));console.log(a),this.$emit("json-file-loaded",a)}},t.readAsText(e)}},props:{scenario:xe}},et=M(V(Q({},Ze),{setup(e){return(t,s)=>(d(),u("div",Xe,[o("label",{class:"btn",onClick:s[0]||(s[0]=(...a)=>t.onSave&&t.onSave(...a))},"Save scenario"),o("label",Ge,[o("input",{id:"hiddenInput",type:"file",onChange:s[1]||(s[1]=(...a)=>t.onFileChange&&t.onFileChange(...a))},null,32),Ke])]))}}));var tt=ee(et,[["__scopeId","data-v-1460b790"]]);const _e=O(new Map);function Ce(){function e(t,...s){_e.value.set(t,s)}return{emit:e,bus:_e}}const T=e=>(le("data-v-5d7e8058"),e=e(),ie(),e),st={class:"hidemenu"},ot={key:0},nt=T(()=>o("div",{class:"description"},"Here you can select the dialogs from this scenario",-1)),at=T(()=>o("hr",null,null,-1)),lt=["onClick"],it={key:1},rt=T(()=>o("div",{class:"description"},"Here you can see and edit the quests for the scenario",-1)),dt=T(()=>o("div",{class:"description small"},"Order them in cronological order (top to bottom) using the left handle to drag the quests.",-1)),ct=T(()=>o("hr",null,null,-1)),ut={class:"list-item"},pt=["disabled","onUpdate:modelValue"],ht={key:2},vt=T(()=>o("div",{class:"description"},"Here you can see and edit the briefing for the scenario",-1)),ft=T(()=>o("hr",null,null,-1)),_t={class:"sidemenu"},gt={key:0},yt=T(()=>o("div",{class:"description"},"You can drag these nodes to the pane.",-1)),mt=T(()=>o("hr",null,null,-1)),xt=T(()=>o("div",{class:"description"},"Player Nodes",-1)),Ct=T(()=>o("hr",null,null,-1)),Nt=T(()=>o("div",{class:"description"},"NPC Nodes",-1)),bt=["onDragstart"],$t={inheritAttrs:!1,mounted(){document.querySelectorAll("textarea").forEach(e=>{e.style.height="",e.style.height=e.scrollHeight+"px"})}},qt=M(V(Q({},$t),{props:{scenario:xe},emits:["dialogSelected"],setup(e,{expose:t,emit:s}){const a=e,{nodes:l,edges:c,addNodes:v,setNodes:P,setEdges:F,instance:m,dimensions:C}=ge(),_=(h,n,w,q)=>{h.dataTransfer&&(h.dataTransfer.setData("application/vueflow",n),h.dataTransfer.setData("application/nodeClass",w),h.dataTransfer.setData("application/npcName",q),h.dataTransfer.effectAllowed="move")};let N=null,$=O(null);O(null);let W=1e3;t({reset:()=>{N=null,$.value=null,P([]),F([])}});const X=(h,n)=>{console.log($),N=h,$.value=n,s("dialogSelected",n),P(h.nodes),F(h.edges)},te=()=>{var h;if(N!=null){let n=prompt("Please enter the new NPC name","");(h=N.actors)==null||h.push(n)}},x=()=>{if(a.scenario!=null){W=W*2;let h={id:W,navigationPoint:{x:0,y:0,z:0},quest:"",questType:0,solved:!1};a.scenario.quests.push(h)}},se=h=>{if(a.scenario!=null){let n=a.scenario.quests.find(q=>q.id==h),w=a.scenario.quests.indexOf(n);a.scenario.quests.splice(w,1)}},{bus:oe}=Ce(),U=new Map;return De(()=>oe.value.get("questChange"),h=>{var n,w;U.clear(),(n=a.scenario)==null||n.conversations.forEach(q=>{q.nodes.forEach(p=>{let g=!1;p.data.texts.forEach(i=>{i.solvesQuest&&(g=!0,console.log(p))}),g&&U.set(p.data.questId,!0)})}),(w=a.scenario)==null||w.quests.forEach(q=>{U.get(q.id)==!0?q.solved=!0:q.solved=!1})}),(h,n)=>{const w=pe("font-awesome-icon"),q=pe("container");return d(),u(R,null,[o("div",st,[S(q,null,{default:ne(()=>[e.scenario!=null?(d(),u("aside",ot,[nt,at,(d(!0),u(R,null,B(e.scenario.conversations,(p,g)=>(d(),u("div",{key:g,class:he(["vue-flow__node-default",{active:g===y($)}]),onClick:i=>X(p,g)}," Dialog "+K(g),11,lt))),128))])):A("",!0),e.scenario!=null?(d(),u("aside",it,[rt,dt,ct,S(y(Ae),{class:"list-container",list:e.scenario.quests,"item-key":"id",handle:".handle"},{item:ne(({element:p})=>[o("div",ut,[S(w,{icon:"grip",class:"handle"}),Z(o("textarea",{disabled:p.questType!=0,name:"quest","onUpdate:modelValue":g=>p.quest=g,rows:"",class:he({solved:p.solved==!0}),oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"'},null,10,pt),[[ve,p.quest]]),p.questType==0?(d(),Pe(w,{key:0,icon:"trash",style:{cursor:"pointer"},onClick:g=>se(p.id)},null,8,["onClick"])):A("",!0)])]),_:1},8,["list"]),(d(!0),u(R,null,B(e.scenario.quests,(p,g)=>(d(),u("div",{key:g}))),128)),o("button",{onClick:x},"Add Quest")])):A("",!0),e.scenario!=null?(d(),u("aside",ht,[vt,ft,Z(o("textarea",{name:"briefing",id:"briefing","onUpdate:modelValue":n[0]||(n[0]=p=>e.scenario.briefing=p),rows:"10"},null,512),[[ve,e.scenario.briefing]])])):A("",!0)]),_:1})]),o("div",_t,[y($)!=null?(d(),u("aside",gt,[yt,mt,xt,o("div",{class:"vue-flow__node-default player1",draggable:!0,onDragstart:n[1]||(n[1]=p=>_(p,"playerNode","player1"))}," Player1 Node ",32),o("div",{class:"vue-flow__node-default player2",draggable:!0,onDragstart:n[2]||(n[2]=p=>_(p,"playerNode","player2"))}," Player2 Node ",32),o("div",{class:"vue-flow__node-default playerAll",draggable:!0,onDragstart:n[3]||(n[3]=p=>_(p,"playerNode","playerAll"))}," All Players Node ",32),Ct,Nt,(d(!0),u(R,null,B(e.scenario.conversations[y($)].actors,(p,g)=>(d(),u("div",{key:g,class:"vue-flow__node-default npc",draggable:!0,onDragstart:i=>_(i,"npcNode","npc",p)},K(p),41,bt))),128)),o("button",{onClick:te},"Add NPC")])):A("",!0)])],64)}}}));var kt=ee(qt,[["__scopeId","data-v-5d7e8058"]]);const re=e=>(le("data-v-1550e24b"),e=e(),ie(),e),St={style:{position:"relative"}},wt=ae(" NPC - "),It=re(()=>o("hr",null,null,-1)),Et=re(()=>o("div",null," Responses: ",-1)),Tt={id:"texts-npcs"},Dt=["value","onInput"],At=["onClick"],Pt=re(()=>o("br",null,null,-1)),Ht={key:0,class:"footer"},Ft={inheritAttrs:!1,mounted(){document.querySelectorAll("textarea").forEach(e=>{e.style.height="",e.style.height=e.scrollHeight+"px"})}},Lt=M(V(Q({},Ft),{props:{id:null,data:null},setup(e){const t=e,s={background:"#555",position:"absolute",top:"20px"};V(Q({},s),{position:"relative",left:"15px",top:"0px",transform:"0"});const a=()=>{let v=new me("",!1);t.data.texts.push(v)},l=(v,P)=>{t.data.texts[P].text=v.target.value},c=v=>{t.data.texts.splice(v,1)};return(v,P)=>(d(),u("div",St,[S(y(J),{type:"target",id:"gi1",position:y(z).Left,style:s,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),S(y(J),{type:"source",id:"go1",position:y(z).Right,style:s,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),o("div",null,[wt,o("strong",null,K(e.data.name),1)]),It,Et,o("ul",Tt,[(d(!0),u(R,null,B(e.data.texts,(F,m)=>(d(),u("li",{key:m,style:{position:"relative"}},[o("textarea",{class:"nodrag",value:e.data.texts[m].text,onInput:C=>l(C,m),oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"'},null,40,Dt),o("span",{onClick:C=>c(m)},"x",8,At)]))),128))]),Pt,o("button",{onClick:a},"Add text"),t.data.fullfilsQuest?(d(),u("div",Ht,"Fullfils Quest")):A("",!0)]))}}));var Qt=ee(Lt,[["__scopeId","data-v-1550e24b"]]);const Y=e=>(le("data-v-63f55a74"),e=e(),ie(),e),Vt={style:{position:"relative"}},Ot={key:0},Rt={key:1},Bt={key:2},Mt=Y(()=>o("hr",null,null,-1)),Ut=Y(()=>o("div",null," Responses: ",-1)),jt={id:"texts-npcs"},zt=["onUpdate:modelValue"],Jt=["value","onInput"],Yt=["onClick"],Wt=Y(()=>o("br",null,null,-1)),Xt=Y(()=>o("hr",null,null,-1)),Gt=ae(" Quest: "),Kt=Y(()=>o("option",{value:"-1"},"None",-1)),Zt=["value"],es={inheritAttrs:!1,mounted(){document.querySelectorAll("textarea").forEach(e=>{e.style.height="",e.style.height=e.scrollHeight+"px"})}},ts=M(V(Q({},es),{props:{id:null,data:null},setup(e){const t=e,{emit:s}=Ce(),a={background:"#555",position:"absolute",top:"20px"},l=V(Q({},a),{position:"relative",left:"15px",top:"0px",transform:"0"}),c=()=>{let m=new me("",!1);t.data.texts.push(m)},v=(m,C)=>{t.data.texts[C].text=m.target.value},P=m=>{t.data.texts.splice(m,1)},F=()=>{let m=!1;t.data.texts.forEach((_,N)=>{_.solvesQuest&&(m=!0)});let C={isSolved:m,questId:t.data.questId};s("questChange",C)};return(m,C)=>(d(),u("div",Vt,[S(y(J),{type:"target",id:"gi1",position:y(z).Left,style:a,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),S(y(J),{type:"source",id:"go1",position:y(z).Right,style:a,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),o("div",null,[t.data.playerType=="player1"?(d(),u("strong",Ot,"Player 1")):A("",!0),t.data.playerType=="player2"?(d(),u("strong",Rt,"Player 2")):A("",!0),t.data.playerType=="playerAll"?(d(),u("strong",Bt,"All Players")):A("",!0)]),Mt,Ut,o("ul",jt,[(d(!0),u(R,null,B(e.data.texts,(_,N)=>(d(),u("li",{key:N,style:{position:"relative"}},[e.data.questId!=-1?Z((d(),u("input",{key:0,type:"checkbox","onUpdate:modelValue":$=>e.data.texts[N].solvesQuest=$,onChange:C[0]||(C[0]=$=>F())},null,40,zt)),[[He,e.data.texts[N].solvesQuest]]):A("",!0),o("textarea",{class:"nodrag",value:e.data.texts[N].text,onInput:$=>v($,N),oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"'},null,40,Jt),S(y(J),{id:"p"+N,type:"source",position:y(z).Right,style:l},null,8,["id","position"]),o("span",{onClick:$=>P(N)},"x",8,Yt)]))),128))]),Wt,o("button",{onClick:c},"Add response"),Xt,o("div",null,[Gt,Z(o("select",{"onUpdate:modelValue":C[1]||(C[1]=_=>e.data.questId=_),style:{"max-width":"170px"},onChange:C[2]||(C[2]=_=>F())},[Kt,(d(!0),u(R,null,B(e.data.quests.filter(_=>_.questType==0),_=>(d(),u("option",{value:_.id,key:_.id},[o("span",null,K(_.quest),1)],8,Zt))),128))],544),[[Fe,e.data.questId]])])]))}}));var ss=ee(ts,[["__scopeId","data-v-63f55a74"]]);const os=M({setup(e){const t=[],{setTransform:s}=Le(),{instance:a,onConnect:l,nodes:c,edges:v,addEdges:P,addNodes:F,setNodes:m,setEdges:C,onEdgesChange:_,onNodesChange:N,setTranslateExtent:$,setState:W,store:Ne}=ge();let X=0;const te=()=>`node${X++}`;let x=O(null);N(i=>{v.value.forEach(r=>{delete r.selected}),i.forEach(r=>{var f,I;if(n.value!=null&&x.value!=null){if(r.type==="position"){let k=n.value.conversations[x.value].nodes.findIndex(function(E){return E.id==r.id});k>=0&&(n.value.conversations[x.value].nodes[k].position.x=(f=r.position)==null?void 0:f.x,n.value.conversations[x.value].nodes[k].position.y=(I=r.position)==null?void 0:I.y)}else if(r.type==="remove"){let k=n.value.conversations[x.value].nodes.findIndex(function(E){return E.id==r.id});n.value.conversations[x.value].nodes.splice(k,1)}}})}),_(i=>{c.value.forEach(r=>{delete r.selected}),i.forEach(r=>{if(r.type==="remove"&&n.value!=null&&x.value!=null){let f=n.value.conversations[x.value].edges.findIndex(function(I){return I.id==r.id});n.value.conversations[x.value].edges.splice(f,1)}})}),l(i=>{if(P([i]),n.value!=null&&x.value!=null){let r="edge-"+i.source+i.sourceHandle+"-"+i.target+i.targetHandle;n.value.conversations[x.value].edges.push(new We(r,i.source,i.target,i.sourceHandle,i.targetHandle))}});const se=i=>{i.preventDefault(),i.dataTransfer&&(i.dataTransfer.dropEffect="move")},oe=i=>{},U=i=>{var r,f,I,k,E;if(a.value){const L=te(),b=[],D=[],H=-1,j=(r=i.dataTransfer)==null?void 0:r.getData("application/vueflow"),G=(f=i.dataTransfer)==null?void 0:f.getData("application/nodeClass"),de=(I=i.dataTransfer)==null?void 0:I.getData("application/npcName"),be=a.value.project({x:i.clientX,y:i.clientY-40}),$e={id:L,type:j,class:G,data:{onChange:oe,onConnect:l,name:de,texts:b,playerType:G,questId:H,quests:(k=n.value)==null?void 0:k.quests},connectable:!0,position:be,label:`${j} node`};F([$e]);let qe=new Ye(L,new Je(i.clientX,i.clientY-40),j,G,new ze(de,G,b,D,!1,H));(E=n.value)==null||E.conversations[x.value].nodes.push(qe)}},h={npcNode:fe(Qt),playerNode:fe(ss)},n=O(null),w=O(null),q=i=>{var f,I,k,E,L;n.value=null,n.value=i,(f=n.value)==null||f.conversations.forEach(b=>{b.nodes.forEach(D=>{var H;D.type=="playerNode"&&(D.data.quests=(H=n.value)==null?void 0:H.quests)})}),(I=n.value)==null||I.quests.forEach(b=>{b.solved=!1});const r=new Map;(k=n.value)==null||k.conversations.forEach(b=>{b.nodes.forEach(D=>{let H=!1;D.data.texts.forEach(j=>{j.solvesQuest&&(H=!0)}),H&&r.set(D.data.questId,!0)})}),(E=n.value)==null||E.quests.forEach(b=>{r.get(b.id)==!0?b.solved=!0:b.solved=!1}),x.value=null,(L=w.value)==null||L.reset()},p=i=>{var E,L,b;x.value=i;let r=0;(E=n.value)==null||E.conversations[i].nodes.forEach((D,H)=>{Number(D.id.substring(4))>r,r=Number(D.id.substring(4))}),X=r+1;const f=(L=n.value)==null?void 0:L.conversations[i].nodes[0],I=Number(f==null?void 0:f.position.x),k=Number((b=f==null?void 0:f.position)==null?void 0:b.y);s({x:I+200||0,y:k+200||0,zoom:1})},g=O(t);return(i,r)=>(d(),u("div",{class:"dndflow",onDrop:U},[S(y(Oe),{modelValue:g.value,"onUpdate:modelValue":r[0]||(r[0]=f=>g.value=f),onDragover:se,"node-types":h},{default:ne(()=>[S(y(Qe),{variant:y(Ve).Lines,"pattern-color":"#4d4d4d",gap:"25"},null,8,["variant"]),S(tt,{scenario:n.value,onJsonFileLoaded:q},null,8,["scenario"]),S(kt,{scenario:n.value,onDialogSelected:p,ref_key:"sideBar",ref:w},null,8,["scenario"])]),_:1},8,["modelValue"])],32))}});const ns={style:{height:"100vh"}},as=M({setup(e){return(t,s)=>(d(),u("div",ns,[S(os)]))}});ye.add(Re);ye.add(Be);Me(as).component("font-awesome-icon",Ue).mount("#app");
