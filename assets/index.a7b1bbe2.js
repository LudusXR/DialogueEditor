var Se=Object.defineProperty,we=Object.defineProperties;var Ie=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var he=(e,t,s)=>t in e?Se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,O=(e,t)=>{for(var s in t||(t={}))Ee.call(t,s)&&he(e,s,t[s]);if(ue)for(var s of ue(t))Te.call(t,s)&&he(e,s,t[s]);return e},R=(e,t)=>we(e,Ie(t));import{d as U,o as r,c,a as o,b as le,F as De,r as Q,D as ye,w as Ae,e as pe,f as w,g as ae,t as z,h as A,i as B,j as M,n as ve,u as g,k as Pe,l as ee,v as fe,m as He,p as ie,q as re,C as J,s as Y,x as Fe,y as Le,R as Qe,z as _e,L as Ve,A as Oe,B as Re,E as me,_ as Be,G as Me,H as Ue,I as je}from"./vendor.5afcc7fa.js";const ze=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const v of u.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&a(v)}).observe(document,{childList:!0,subtree:!0});function s(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerpolicy&&(u.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?u.credentials="include":l.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function a(l){if(l.ep)return;l.ep=!0;const u=s(l);fetch(l.href,u)}};ze();class xe{constructor(t,s){this.text=t,this.solvesQuest=s}}class Je{constructor(t,s,a,l,u,v){this.name=t,this.playerType=s,this.texts=a,this.useSocialActions=u,this.triggers=l,this.questId=v}}class Ye{constructor(t,s){this.x=t,this.y=s}}class We{constructor(t,s,a,l,u){this.id=t,this.position=s,this.type=a,this.class=l,this.data=u}}class Xe{constructor(t,s,a,l,u){this.id=t,this.source=s,this.target=a,this.sourceHandle=l,this.targetHandle=u}}class Ce{}var te=(e,t)=>{const s=e.__vccOpts||e;for(const[a,l]of t)s[a]=l;return s};const Ge={class:"save__controls"},Ke={class:"btn"},Ze=le(" Load scenario "),et={inheritAttrs:!1,methods:{onFileChange(e){let t=e.target.files;t==null||!t.length||this.doSomethingWithTheFile(t[0])},onSave(){let e=prompt("Define your file name.");if(this.$props.scenario!=null){let s=JSON.parse(JSON.stringify(this.$props.scenario));s.quests.forEach((a,l)=>{a.order=l}),s.conversations.forEach(a=>{a.nodes.forEach(l=>{if(l.type=="playerNode"){if(l.data.questId>-1){let u=s.quests.find(v=>v.id==l.data.questId);u!=null?l.data.questId=u.order:l.data.questId=-1}delete l.data.quests}})}),s.quests.forEach(a=>{a.id=a.order,delete a.solved,delete a.order});var t=new Blob([JSON.stringify(s)],{type:"application/json"});De.exports.saveAs(t,e)}},doSomethingWithTheFile(e){let t=new FileReader;t.onload=s=>{if(s.target!=null){let a=JSON.parse(String(s.target.result));this.$emit("json-file-loaded",{scenario:a,filename:e.name})}},t.readAsText(e)}},props:{scenario:Ce}},tt=U(R(O({},et),{setup(e){return(t,s)=>(r(),c("div",Ge,[o("label",{class:"btn",onClick:s[0]||(s[0]=(...a)=>t.onSave&&t.onSave(...a))},"Save scenario"),o("label",Ke,[o("input",{id:"hiddenInput",type:"file",onChange:s[1]||(s[1]=(...a)=>t.onFileChange&&t.onFileChange(...a))},null,32),Ze])]))}}));var st=te(tt,[["__scopeId","data-v-109c846b"]]);const ge=Q(new Map);function be(){function e(t,...s){ge.value.set(t,s)}return{emit:e,bus:ge}}const q=e=>(ie("data-v-77a0afe6"),e=e(),re(),e),ot={class:"hidemenu"},nt={key:0},at=q(()=>o("div",{class:"description"},"Current file being edited:",-1)),lt=q(()=>o("hr",null,null,-1)),it={key:1},rt=q(()=>o("div",{class:"description"},"Here you can select the dialogs from this scenario",-1)),dt=q(()=>o("hr",null,null,-1)),ct=["onClick"],ut={key:2},ht=q(()=>o("div",{class:"description"},"Here you can see and edit the quests for the scenario",-1)),pt=q(()=>o("div",{class:"description small"},"Order them in cronological order (top to bottom) using the left handle to drag the quests.",-1)),vt=q(()=>o("hr",null,null,-1)),ft={class:"list-item"},_t=["disabled","onUpdate:modelValue"],gt={key:3},yt=q(()=>o("div",{class:"description"},"Here you can see and edit the briefing for the scenario",-1)),mt=q(()=>o("hr",null,null,-1)),xt={class:"sidemenu"},Ct={key:0},bt=q(()=>o("div",{class:"description"},"You can drag these nodes to the pane.",-1)),Nt=q(()=>o("hr",null,null,-1)),$t=q(()=>o("div",{class:"description"},"Player Nodes",-1)),qt=q(()=>o("hr",null,null,-1)),kt=q(()=>o("div",{class:"description"},"NPC Nodes",-1)),St=["onDragstart"],wt={inheritAttrs:!1,mounted(){document.querySelectorAll("textarea").forEach(e=>{e.style.height="",e.style.height=e.scrollHeight+"px"})}},It=U(R(O({},wt),{props:{scenario:Ce,filename:String},emits:["dialogSelected"],setup(e,{expose:t,emit:s}){const a=e,{nodes:l,edges:u,addNodes:v,setNodes:H,setEdges:F,instance:y,dimensions:C}=ye(),_=(p,n,k,$)=>{p.dataTransfer&&(p.dataTransfer.setData("application/vueflow",n),p.dataTransfer.setData("application/nodeClass",k),p.dataTransfer.setData("application/npcName",$),p.dataTransfer.effectAllowed="move")};let b=null,I=Q(null);Q(null);let X=1e3;t({reset:()=>{b=null,I.value=null,H([]),F([])}});const G=(p,n)=>{b=p,I.value=n,s("dialogSelected",n),H(p.nodes),F(p.edges)},se=()=>{var p;if(b!=null){let n=prompt("Please enter the new NPC name","");(p=b.actors)==null||p.push(n)}},m=()=>{if(a.scenario!=null){X=X*2;let p={id:X,navigationPoint:{x:0,y:0,z:0},quest:"",questType:0,solved:!1};a.scenario.quests.push(p)}},oe=p=>{if(a.scenario!=null){let n=a.scenario.quests.find($=>$.id==p),k=a.scenario.quests.indexOf(n);a.scenario.quests.splice(k,1)}},{bus:ne}=be(),j=new Map;return Ae(()=>ne.value.get("questChange"),p=>{var n,k;j.clear(),(n=a.scenario)==null||n.conversations.forEach($=>{$.nodes.forEach(h=>{let x=!1;h.data.texts.forEach(V=>{V.solvesQuest&&(x=!0)}),x&&j.set(h.data.questId,!0)})}),(k=a.scenario)==null||k.quests.forEach($=>{j.get($.id)==!0?$.solved=!0:$.solved=!1})}),(p,n)=>{const k=pe("font-awesome-icon"),$=pe("container");return r(),c(B,null,[o("div",ot,[w($,null,{default:ae(()=>[e.scenario!=null?(r(),c("aside",nt,[at,lt,o("div",null,z(e.filename),1)])):A("",!0),e.scenario!=null?(r(),c("aside",it,[rt,dt,(r(!0),c(B,null,M(e.scenario.conversations,(h,x)=>(r(),c("div",{key:x,class:ve(["vue-flow__node-default",{active:x===g(I)}]),onClick:V=>G(h,x)}," Dialog "+z(x),11,ct))),128))])):A("",!0),e.scenario!=null?(r(),c("aside",ut,[ht,pt,vt,w(g(Pe),{class:"list-container",list:e.scenario.quests,"item-key":"id",handle:".handle"},{item:ae(({element:h})=>[o("div",ft,[w(k,{icon:"grip",class:"handle"}),ee(o("textarea",{disabled:h.questType!=0,name:"quest","onUpdate:modelValue":x=>h.quest=x,rows:"",class:ve({solved:h.solved==!0}),oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"'},null,10,_t),[[fe,h.quest]]),h.questType==0?(r(),He(k,{key:0,icon:"trash",style:{cursor:"pointer"},onClick:x=>oe(h.id)},null,8,["onClick"])):A("",!0)])]),_:1},8,["list"]),(r(!0),c(B,null,M(e.scenario.quests,(h,x)=>(r(),c("div",{key:x}))),128)),o("button",{onClick:m},"Add Quest")])):A("",!0),e.scenario!=null?(r(),c("aside",gt,[yt,mt,ee(o("textarea",{name:"briefing",id:"briefing","onUpdate:modelValue":n[0]||(n[0]=h=>e.scenario.briefing=h),rows:"10"},null,512),[[fe,e.scenario.briefing]])])):A("",!0)]),_:1})]),o("div",xt,[g(I)!=null?(r(),c("aside",Ct,[bt,Nt,$t,o("div",{class:"vue-flow__node-default player1",draggable:!0,onDragstart:n[1]||(n[1]=h=>_(h,"playerNode","player1"))}," Player1 Node ",32),o("div",{class:"vue-flow__node-default player2",draggable:!0,onDragstart:n[2]||(n[2]=h=>_(h,"playerNode","player2"))}," Player2 Node ",32),o("div",{class:"vue-flow__node-default playerAll",draggable:!0,onDragstart:n[3]||(n[3]=h=>_(h,"playerNode","playerAll"))}," All Players Node ",32),qt,kt,(r(!0),c(B,null,M(e.scenario.conversations[g(I)].actors,(h,x)=>(r(),c("div",{key:x,class:"vue-flow__node-default npc",draggable:!0,onDragstart:V=>_(V,"npcNode","npc",h)},z(h),41,St))),128)),o("button",{onClick:se},"Add NPC")])):A("",!0)])],64)}}}));var Et=te(It,[["__scopeId","data-v-77a0afe6"]]);const de=e=>(ie("data-v-1550e24b"),e=e(),re(),e),Tt={style:{position:"relative"}},Dt=le(" NPC - "),At=de(()=>o("hr",null,null,-1)),Pt=de(()=>o("div",null," Responses: ",-1)),Ht={id:"texts-npcs"},Ft=["value","onInput"],Lt=["onClick"],Qt=de(()=>o("br",null,null,-1)),Vt={key:0,class:"footer"},Ot={inheritAttrs:!1,mounted(){document.querySelectorAll("textarea").forEach(e=>{e.style.height="",e.style.height=e.scrollHeight+"px"})}},Rt=U(R(O({},Ot),{props:{id:null,data:null},setup(e){const t=e,s={background:"#555",position:"absolute",top:"20px"};R(O({},s),{position:"relative",left:"15px",top:"0px",transform:"0"});const a=()=>{let v=new xe("",!1);t.data.texts.push(v)},l=(v,H)=>{t.data.texts[H].text=v.target.value},u=v=>{t.data.texts.splice(v,1)};return(v,H)=>(r(),c("div",Tt,[w(g(Y),{type:"target",id:"gi1",position:g(J).Left,style:s,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),w(g(Y),{type:"source",id:"go1",position:g(J).Right,style:s,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),o("div",null,[Dt,o("strong",null,z(e.data.name),1)]),At,Pt,o("ul",Ht,[(r(!0),c(B,null,M(e.data.texts,(F,y)=>(r(),c("li",{key:y,style:{position:"relative"}},[o("textarea",{class:"nodrag",value:e.data.texts[y].text,onInput:C=>l(C,y),oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"'},null,40,Ft),o("span",{onClick:C=>u(y)},"x",8,Lt)]))),128))]),Qt,o("button",{onClick:a},"Add text"),t.data.fullfilsQuest?(r(),c("div",Vt,"Fullfils Quest")):A("",!0)]))}}));var Bt=te(Rt,[["__scopeId","data-v-1550e24b"]]);const W=e=>(ie("data-v-63f55a74"),e=e(),re(),e),Mt={style:{position:"relative"}},Ut={key:0},jt={key:1},zt={key:2},Jt=W(()=>o("hr",null,null,-1)),Yt=W(()=>o("div",null," Responses: ",-1)),Wt={id:"texts-npcs"},Xt=["onUpdate:modelValue"],Gt=["value","onInput"],Kt=["onClick"],Zt=W(()=>o("br",null,null,-1)),es=W(()=>o("hr",null,null,-1)),ts=le(" Quest: "),ss=W(()=>o("option",{value:"-1"},"None",-1)),os=["value"],ns={inheritAttrs:!1,mounted(){document.querySelectorAll("textarea").forEach(e=>{e.style.height="",e.style.height=e.scrollHeight+"px"})}},as=U(R(O({},ns),{props:{id:null,data:null},setup(e){const t=e,{emit:s}=be(),a={background:"#555",position:"absolute",top:"20px"},l=R(O({},a),{position:"relative",left:"15px",top:"0px",transform:"0"}),u=()=>{let y=new xe("",!1);t.data.texts.push(y)},v=(y,C)=>{t.data.texts[C].text=y.target.value},H=y=>{t.data.texts.splice(y,1)},F=()=>{let y=!1;t.data.texts.forEach((_,b)=>{_.solvesQuest&&(y=!0)});let C={isSolved:y,questId:t.data.questId};s("questChange",C)};return(y,C)=>(r(),c("div",Mt,[w(g(Y),{type:"target",id:"gi1",position:g(J).Left,style:a,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),w(g(Y),{type:"source",id:"go1",position:g(J).Right,style:a,"on-connect":t.data.onConnect},null,8,["position","on-connect"]),o("div",null,[t.data.playerType=="player1"?(r(),c("strong",Ut,"Player 1")):A("",!0),t.data.playerType=="player2"?(r(),c("strong",jt,"Player 2")):A("",!0),t.data.playerType=="playerAll"?(r(),c("strong",zt,"All Players")):A("",!0)]),Jt,Yt,o("ul",Wt,[(r(!0),c(B,null,M(e.data.texts,(_,b)=>(r(),c("li",{key:b,style:{position:"relative"}},[e.data.questId!=-1?ee((r(),c("input",{key:0,type:"checkbox","onUpdate:modelValue":I=>e.data.texts[b].solvesQuest=I,onChange:C[0]||(C[0]=I=>F())},null,40,Xt)),[[Fe,e.data.texts[b].solvesQuest]]):A("",!0),o("textarea",{class:"nodrag",value:e.data.texts[b].text,onInput:I=>v(I,b),oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"'},null,40,Gt),w(g(Y),{id:"p"+b,type:"source",position:g(J).Right,style:l},null,8,["id","position"]),o("span",{onClick:I=>H(b)},"x",8,Kt)]))),128))]),Zt,o("button",{onClick:u},"Add response"),es,o("div",null,[ts,ee(o("select",{"onUpdate:modelValue":C[1]||(C[1]=_=>e.data.questId=_),style:{"max-width":"170px"},onChange:C[2]||(C[2]=_=>F())},[ss,(r(!0),c(B,null,M(e.data.quests.filter(_=>_.questType==0),_=>(r(),c("option",{value:_.id,key:_.id},[o("span",null,z(_.quest),1)],8,os))),128))],544),[[Le,e.data.questId]])])]))}}));var ls=te(as,[["__scopeId","data-v-63f55a74"]]);const is=U({setup(e){const t=[],{setTransform:s}=Qe(),{instance:a,onConnect:l,nodes:u,edges:v,addEdges:H,addNodes:F,setNodes:y,setEdges:C,onEdgesChange:_,onNodesChange:b,setTranslateExtent:I,setState:X,store:Ne}=ye();let G=0;const se=()=>`node${G++}`;let m=Q(null);b(i=>{v.value.forEach(d=>{delete d.selected}),i.forEach(d=>{var f,E;if(n.value!=null&&m.value!=null){if(d.type==="position"){let S=n.value.conversations[m.value].nodes.findIndex(function(T){return T.id==d.id});S>=0&&(n.value.conversations[m.value].nodes[S].position.x=(f=d.position)==null?void 0:f.x,n.value.conversations[m.value].nodes[S].position.y=(E=d.position)==null?void 0:E.y)}else if(d.type==="remove"){let S=n.value.conversations[m.value].nodes.findIndex(function(T){return T.id==d.id});n.value.conversations[m.value].nodes.splice(S,1)}}})}),_(i=>{u.value.forEach(d=>{delete d.selected}),i.forEach(d=>{if(d.type==="remove"&&n.value!=null&&m.value!=null){let f=n.value.conversations[m.value].edges.findIndex(function(E){return E.id==d.id});n.value.conversations[m.value].edges.splice(f,1)}})}),l(i=>{if(H([i]),n.value!=null&&m.value!=null){let d="edge-"+i.source+i.sourceHandle+"-"+i.target+i.targetHandle;n.value.conversations[m.value].edges.push(new Xe(d,i.source,i.target,i.sourceHandle,i.targetHandle))}});const oe=i=>{i.preventDefault(),i.dataTransfer&&(i.dataTransfer.dropEffect="move")},ne=i=>{},j=i=>{var d,f,E,S,T;if(a.value){const P=(d=i.dataTransfer)==null?void 0:d.getData("application/vueflow");if(P=="")return;const N=se(),D=[],L=[],K=-1,Z=(f=i.dataTransfer)==null?void 0:f.getData("application/nodeClass"),ce=(E=i.dataTransfer)==null?void 0:E.getData("application/npcName"),$e=a.value.project({x:i.clientX,y:i.clientY-40}),qe={id:N,type:P,class:Z,data:{onChange:ne,onConnect:l,name:ce,texts:D,playerType:Z,questId:K,quests:(S=n.value)==null?void 0:S.quests},connectable:!0,position:$e,label:`${P} node`};F([qe]);let ke=new We(N,new Ye(i.clientX,i.clientY-40),P,Z,new Je(ce,Z,D,L,!1,K));(T=n.value)==null||T.conversations[m.value].nodes.push(ke)}},p={npcNode:_e(Bt),playerNode:_e(ls)},n=Q(null),k=Q(null),$=Q(null),h=i=>{var f,E,S,T,P;n.value=null,n.value=i.scenario,k.value=null,k.value=i.filename,(f=n.value)==null||f.conversations.forEach(N=>{N.nodes.forEach(D=>{var L;D.type=="playerNode"&&(D.data.quests=(L=n.value)==null?void 0:L.quests)})}),(E=n.value)==null||E.quests.forEach(N=>{N.solved=!1});const d=new Map;(S=n.value)==null||S.conversations.forEach(N=>{N.nodes.forEach(D=>{let L=!1;D.data.texts.forEach(K=>{K.solvesQuest&&(L=!0)}),L&&d.set(D.data.questId,!0)})}),(T=n.value)==null||T.quests.forEach(N=>{d.get(N.id)==!0?N.solved=!0:N.solved=!1}),m.value=null,(P=$.value)==null||P.reset()},x=i=>{var T,P,N;m.value=i;let d=0;(T=n.value)==null||T.conversations[i].nodes.forEach((D,L)=>{Number(D.id.substring(4))>d,d=Number(D.id.substring(4))}),G=d+1;const f=(P=n.value)==null?void 0:P.conversations[i].nodes[0],E=Number(f==null?void 0:f.position.x),S=Number((N=f==null?void 0:f.position)==null?void 0:N.y);s({x:E+200||0,y:S+200||0,zoom:1})},V=Q(t);return(i,d)=>(r(),c("div",{class:"dndflow",onDrop:j},[w(g(Re),{modelValue:V.value,"onUpdate:modelValue":d[0]||(d[0]=f=>V.value=f),onDragover:oe,"node-types":p},{default:ae(()=>[w(g(Ve),{variant:g(Oe).Lines,"pattern-color":"#4d4d4d",gap:"25"},null,8,["variant"]),w(st,{scenario:n.value,onJsonFileLoaded:h},null,8,["scenario"]),w(Et,{scenario:n.value,filename:k.value,onDialogSelected:x,ref_key:"sideBar",ref:$},null,8,["scenario","filename"])]),_:1},8,["modelValue"])],32))}});const rs={style:{height:"100vh"}},ds=U({setup(e){return(t,s)=>(r(),c("div",rs,[w(is)]))}});me.add(Be);me.add(Me);Ue(ds).component("font-awesome-icon",je).mount("#app");
